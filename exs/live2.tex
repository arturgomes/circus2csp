\begin{zed}
SWITCH ::= ON | OFF
\also NatValue == 0 \upto 3
\end{zed}

\begin{circus}
  \circchannel start,stop\\
  \circchannel getCurrentTime~:~\nat\\
  \circchannel tick
\end{circus}

\begin{schema}{SysCmdS}
 time : \nat\\
 swi : SWITCH
\end{schema}
\begin{circus}%
  \circprocess\ ~SysCmd ~\circdef~\circbegin
  \circstate SysCmdSt \defs SysCmdS
  Start ~\circdef~
  \\\t2 start \then (swi,time := ON,0) \circseq Clock\\
  Clock ~\circdef~ 
  \circmu~X \circspot 
    ((\circif time \leq 2 \circthen ((tick \then (time := time+1) \circseq X) \interleave (getCurrentTime!time \then X))
        \circelse time > 2 \circthen ((time,swi := 0,OFF) \circseq (stop \then \Skip)) 
        \circfi) \circseq X)
  \circspot Start
  \circend
\end{circus}
\begin{circus}
\circprocess\ ~MakeTick ~\circdef~\circbegin
\circspot tick \then \Skip
\circend
\end{circus}

Clock = 
  (SysClock2 \ {|mget,mset,terminate,getCurrentTime|}) 
  -- [| {|tick|} |] MakeTick 

assert Clock [FD= MakeTick
