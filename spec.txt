ZGivenSetDecl ("HOUR",[])
ZGivenSetDecl ("MINUTE",[])
ZGivenSetDecl ("NAT",[])
ZFreeTypeDef ("BUTTON",[]) [ZBranch0 ("ON",[]),ZBranch0 ("OFF",[])]
ZFreeTypeDef ("SWITCH",[]) [ZBranch0 ("ENABLED",[]),ZBranch0 ("DISABLED",[])]
ZFreeTypeDef ("DIRECTION",[]) [ZBranch0 ("FORWARD",[]),ZBranch0 ("BACKWARDS",[])]
ZFreeTypeDef ("STATEPHASE",[]) [ZBranch0 ("connectThePatient",[]),ZBranch0 ("initPhase",[]),ZBranch0 ("prepPhase",[]),ZBranch0 ("endPhase",[])]
ZFreeTypeDef ("ACTIVITY",[]) [ZBranch0 ("rinsingEBC",[]),ZBranch0 ("applicationArterialBolus",[]),ZBranch0 ("anticoagDelivRun",[]),ZBranch0 ("reinfProcess",[]),ZBranch0 ("preparationOfDF",[]),ZBranch0 ("priming",[]),ZBranch0 ("rinsing",[]),ZBranch0 ("idle",[])]
ZFreeTypeDef ("LID",[]) [ZBranch0 ("OPEN",[]),ZBranch0 ("CLOSED",[])]
ZFreeTypeDef ("CONCENTRATE",[]) [ZBranch0 ("ACID",[]),ZBranch0 ("ACETATE",[]),ZBranch0 ("BICARBONATE",[])]
ZAbbreviation ("TIME",[]) (ZSetComp [Choose ("h",[]) (ZVar ("HOUR",[])),Choose ("m",[]) (ZVar ("HOUR",[]))] (Just (ZTuple [ZVar ("h",[]),ZVar ("m",[])])))
ZFreeTypeDef ("HDMODE",[]) [ZBranch0 ("RUN",[]),ZBranch0 ("ALARM",[]),ZBranch0 ("BYPASS",[])]
ZFreeTypeDef ("LAMP",[]) [ZBranch0 ("GREEN",[]),ZBranch0 ("YELLOW",[])]
ZFreeTypeDef ("BOOL",[]) [ZBranch0 ("TRUE",[]),ZBranch0 ("FALSE",[])]
CircChannel [CChan "preparationPhase",CChan "therapyInitiation"]
CircChannel [CChan "connectingToPatient",CChan "duringTherapy",CChan "therapyEnding"]
CircChannel [CChan "autSelfTest",CChan "atrialTubing"]
CircChannel [CChan "ventricularTubing",CChan "connectDialyzer"]
CircChannel [CChan "stopBloodFlow",CChan "produceAlarmSound",CChan "stopBP"]
CircChannel [CChan "disconnectDF",CChan "stopFlowDialyzer",CChan "stopCoagulantFlow"]
CircChannel [CChan "fillArterialDrip",CChan "connPatientArterially",CChan "connPatientVenously"]
CircChannel [CChan "insertHeparinSyringe",CChan "heparinLineIsVented"]
CircChannel [CChanDecl "connectingConcentrate" (ZVar ("CONCENTRATE",[]))]
CircChannel [CChanDecl "salineBagLevel" (ZVar ("NAT",[]))]
CircChannel [CChanDecl "senAirVol" (ZVar ("NAT",[]))]
CircChannel [CChanDecl "senAirVolLimit" (ZVar ("NAT",[]))]
CircChannel [CChanDecl "senApTransdPress" (ZVar ("NAT",[]))]
CircChannel [CChanDecl "senBloodFlowInEBC" (ZVar ("NAT",[]))]
CircChannel [CChanDecl "senBypassVol" (ZVar ("LID",[]))]
CircChannel [CChanDecl "senFflowDirect" (ZVar ("DIRECTION",[]))]
CircChannel [CChanDecl "senInfVol" (ZVar ("NAT",[]))]
CircChannel [CChanDecl "senLastNonZeroBF" (ZVar ("NAT",[]))]
CircChannel [CChanDecl "senNetFluidRemoval" (ZVar ("SWITCH",[]))]
CircChannel [CChanDecl "senNetFluidRemovalRate" (ZVar ("NAT",[]))]
CircChannel [CChanDecl "senRotDirectBP" (ZVar ("DIRECTION",[]))]
CircChannel [CChanDecl "senRotDirectUFP" (ZVar ("DIRECTION",[]))]
CircChannel [CChanDecl "senVolInEBC" (ZVar ("NAT",[]))]
CircChannel [CChanDecl "senVpTransdPress" (ZVar ("NAT",[]))]
CircChannel [CChanDecl "senSADSensorFlow" (ZVar ("NAT",[]))]
CircChannel [CChanDecl "senHDMode" (ZVar ("HDMODE",[]))]
CircChannel [CChanDecl "setMinUFRateTreat" (ZVar ("BUTTON",[]))]
CircChanSet "TherapyPhaseChanSet" (CChanSet ["preparationPhase","therapyInitiation","connectingToPatient","duringTherapy","therapyEnding"])
CircChanSet "SensorReadingsComm" (CChanSet ["senAirVol","senApTransdPress","senBloodFlowInEBC","senHDMode","senSADSensorFlow","senVpTransdPress"])
CircChanSet "HDComm" (CChanSet ["getApTransdPress","getBloodFlowInEBC","getCurrentTime","getDfFlow","getHdActivity","getHdMachineState","getFflowDirect","getInfSalineVol","getVolInEBC","getLowerPressureLimit","getRotDirectUFP","getUpperPressureLimit","getDfTemperature","getVpTransdPress","senBloodFlowInEBC","senSADSensorFlow","setAirVol","setBloodFlowInEBC","setLastNonZeroBF","therapyInitiation","senVpTransdPress","getTimerIntervalR9","setTimerIntervalR9","getTimerIntervalR10","setTimerIntervalR10","getTimerIntervalR9"])
CircChanSet "HDGenCompStChanSet" (CChanSet ["getAirVolLimit","getAirVol","getApTransdPress","getArtBolusVol","getBloodFlowInEBC","getBypassValve","getFflowDirect","getHdActivity","getHDMode","getInfSalineVol","getLastNonZeroBF","getLowerPressureLimit","getMinUFRateTreat","getNetFluidRemoval","getNetFluidRemovalRate","getSADSensorFlow","getSafeUpperLimit","getSignalLamp","getTimerIntervalR10","getTimerIntervalR11","getTimerIntervalR12","getTimerIntervalR13","getTimerIntervalR9","getUpperPressureLimit","getVolInEBC","getVpTransdPress","getBloodLines","setAirVolLimit","setAirVol","setAlarm","setBloodFlowInEBC","setLastNonZeroBF","setTimerIntervalR10","setTimerIntervalR11","setTimerIntervalR12","setTimerIntervalR13","setTimerIntervalR9","getRotDirectBP","getRotDirectUFP","preparationPhase","connectingToPatient","therapyInitiation","therapyEnding"])
CircChanSet "RinsingParametersStChanSet" (CChanSet ["setFillingBPRate","setRinsingBPRate","setRinsingTime","setUfVolForRinsing","setBloodFlowForConnectingPatient","getRinsingBPRate","getRinsingTime","setUfRateForRinsing","getUfRateForRinsing","getUfVolForRinsing","getBloodFlowForConnectingPatient","getFillingBPRate"])
CircChanSet "PressureParametersStChanSet" (CChanSet ["setLimitDeltaMinMaxAP","setActualTMPMaxTMP","setLimitsTMP","setLowHigh","setExtendedTMPLimitRange","getLimitDeltaMinMaxAP","getActualTMPMaxTMP","getLimitsTMP","getLowHigh","getExtendedTMPLimitRange"])
CircChanSet "HeparinParametersStChanSet" (CChanSet ["setTreatmentWithoutHeparin","setHeparinBolusVol","setHeparinProfileRate","getHeparinBolusVol","getHeparinProfileRate","getTreatmentWithoutHeparin","setSyringeType","getSyringeType"])
CircChanSet "UFParametersStChanSet" (CChanSet ["setMaxUFRate","setMinUFRate","setTherapyTime","setUfVol","getMaxUFRate","getMinUFRate","getTherapyTime","getUfVol"])
CircChanSet "DFParametersStChanSet" (CChanSet ["setBicarbonateAcetate","setBicarbonateConductivity","setDfFlow","setDfTemperature","setConductivity","getBicarbonateAcetate","getConductivity","getDfFlow","getDfTemperature","getBicarbonateConductivity"])
CircChanSet "DFParametersStComm" (CChanSet ["setConductivity","setBicarbonateAcetate","setBicarbonateConductivity","setDfTemperature","setDfFlow"])
CircChanSet "UFParametersStComm" (CChanSet ["setUfVol","setTherapyTime","setMinUFRate","setMaxUFRate"])
CircChanSet "PressureParametersStComm" (CChanSet ["setLimitDeltaMinMaxAP","setActualTMPMaxTMP","setLimitsTMP","setLowHigh","setExtendedTMPLimitRange"])
CircChanSet "HeparinParametersStComm" (CChanSet ["setHeparinStopTime","setHeparinBolusVol","setHeparinProfileRate","setTreatmentWithoutHeparin","setSyringeType"])
CircChanSet "RinsingParametersStComm" (CChanSet ["setFillingBPRate","setRinsingBPRate","setRinsingTime","setUfRateForRinsing","setUfVolForRinsing","setBloodFlowForConnectingPatient"])
CircChanSet "MainTherapyChanSet" (CChanSet ["setActualTMPMaxTMP","setArtBolusVol","setBicarbonateAcetate","setBicarbonateConductivity","setBloodFlowForConnectingPatient","setBloodFlowInEBC","setBloodLines","setConductivity","setDfFlow","setDfTemperature","setExtendedTMPLimitRange","setFillingBPRate","setHDMode","setHeparinBolusVol","setHeparinProfileRate","setHeparinStopTime","setInfSalineVol","setLimitDeltaMinMaxAP","setLimitsTMP","setLowHigh","setMaxUFRate","setMinUFRate","setMinUFRateTreat","setRinsingBPRate","setRinsingTime","setSignalLamp","setSyringeType","setTherapyTime","setTreatmentWithoutHeparin","setUfRateForRinsing","setUfVol","setUfVolForRinsing","preparationPhase","therapyInitiation","connectingToPatient","duringTherapy","therapyEnding"])
Process (CProcess "SysClock" (ProcDef (ProcMain (ZSchemaDef (ZSPlain "SysClockSt") (ZSchema [Choose ("time",[]) (ZVar ("NAT",[]))])) [CParAction "ResetClock" (CircusAction (CSPSeq (CActionCommand (CAssign ["time"] [ZInt 0])) (CActionName "Clock"))),CParAction "Clock" (CircusAction (CSPRecursion "X" (CSPInterleave (CSPCommAction (ChanComm "tick" []) (CActionCommand (CAssign ["time"] [ZCall (ZVar ("+",[])) (ZTuple [ZVar ("time",[]),ZInt 1])]))) (CSPCommAction (ChanComm "getCurrentTime" [ChanOutExp (ZVar ("time",[]))]) (CSPSeq CSPSkip (CActionName "X")))))),CParAction "Wait" (CircusAction (CActionCommand (CValDecl [Choose ("n",[]) (ZVar ("NAT",[]))] (CActionCommand (CIf (CircThenElse (CircGAction (ZMember (ZTuple [ZVar ("n",[]),ZInt 0]) (ZVar (">",[]))) (CSPCommAction (ChanComm "tick" []) (CSPParAction "Wait" [ZCall (ZVar ("-",[])) (ZTuple [ZVar ("n",[]),ZInt 1])]))) (CircGAction (ZEqual (ZVar ("n",[])) (ZInt 0)) CSPSkip)))))))] (CActionName "ResetClock"))))
ZSchemaDef (ZSPlain "HDGenComp") (ZSchema [Choose ("airVolLimit",[]) (ZVar ("NAT",[])),Choose ("airVol",[]) (ZVar ("NAT",[])),Choose ("alarm",[]) (ZVar ("SWITCH",[])),Choose ("artBolusVol",[]) (ZVar ("NAT",[])),Choose ("apTransdPress",[]) (ZVar ("NAT",[])),Choose ("bloodFlowInEBC",[]) (ZVar ("NAT",[])),Choose ("bypassValve",[]) (ZVar ("LID",[])),Choose ("fflowDirect",[]) (ZVar ("DIRECTION",[])),Choose ("hdActivity",[]) (ZCall (ZVar ("\\power",[])) (ZVar ("ACTIVITY",[]))),Choose ("hdMachineState",[]) (ZCall (ZVar ("\\power",[])) (ZVar ("STATEPHASE",[]))),Choose ("hdMode",[]) (ZVar ("HDMODE",[])),Choose ("infSalineVol",[]) (ZVar ("NAT",[])),Choose ("lastNonZeroBF",[]) (ZVar ("NAT",[])),Choose ("lowerPressureLimit",[]) (ZVar ("NAT",[])),Choose ("netFluidRemovalRate",[]) (ZVar ("NAT",[])),Choose ("netFluidRemoval",[]) (ZVar ("SWITCH",[])),Choose ("rotDirectionBP",[]) (ZVar ("DIRECTION",[])),Choose ("rotDirectionUFP",[]) (ZVar ("DIRECTION",[])),Choose ("safeUpperLimit",[]) (ZVar ("NAT",[])),Choose ("timerIntervalR9",[]) (ZVar ("NAT",[])),Choose ("timerIntervalR10",[]) (ZVar ("NAT",[])),Choose ("timerIntervalR11",[]) (ZVar ("NAT",[])),Choose ("timerIntervalR12",[]) (ZVar ("NAT",[])),Choose ("timerIntervalR13",[]) (ZVar ("NAT",[])),Choose ("time",[]) (ZVar ("NAT",[])),Choose ("upperPressureLimit",[]) (ZVar ("NAT",[])),Choose ("volumeInEBC",[]) (ZVar ("NAT",[])),Choose ("vpTransdPress",[]) (ZVar ("NAT",[])),Choose ("sadSensorFlow",[]) (ZVar ("NAT",[])),Choose ("bloodLines",[]) (ZVar ("BOOL",[])),Choose ("minUFRateTreat",[]) (ZVar ("BUTTON",[]))])
ZSchemaDef (ZSPlain "RinsingParameters") (ZSchema [Choose ("fillingBPRate",[]) (ZVar ("NAT",[])),Choose ("rinsingBPRate",[]) (ZVar ("NAT",[])),Choose ("rinsingTime",[]) (ZVar ("NAT",[])),Choose ("ufRateForRinsing",[]) (ZVar ("NAT",[])),Choose ("ufVolForRinsing",[]) (ZVar ("NAT",[])),Choose ("bloodFlowForConnectingPatient",[]) (ZVar ("NAT",[])),Check (ZMember (ZVar ("fillingBPRate",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 0,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 6000]) (ZVar ("\\leq",[]))))] Nothing)),Check (ZMember (ZVar ("rinsingBPRate",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 50,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 300]) (ZVar ("\\leq",[]))))] Nothing)),Check (ZMember (ZVar ("rinsingTime",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 0,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 59]) (ZVar ("\\leq",[]))))] Nothing)),Check (ZMember (ZVar ("ufRateForRinsing",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 50,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 3000]) (ZVar ("\\leq",[]))))] Nothing)),Check (ZMember (ZVar ("ufVolForRinsing",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 50,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 2940]) (ZVar ("\\leq",[]))))] Nothing)),Check (ZMember (ZVar ("bloodFlowForConnectingPatient",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 50,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 600]) (ZVar ("\\leq",[]))))] Nothing))])
ZSchemaDef (ZSPlain "DFParameters") (ZSchema [Choose ("conductivity",[]) (ZVar ("NAT",[])),Choose ("bicarbonateAcetate",[]) (ZVar ("CONCENTRATE",[])),Choose ("bicarbonateConductivity",[]) (ZVar ("NAT",[])),Choose ("dfTemperature",[]) (ZVar ("NAT",[])),Choose ("rinsingTime",[]) (ZVar ("NAT",[])),Choose ("dfFlow",[]) (ZVar ("NAT",[])),Check (ZMember (ZVar ("conductivity",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 125,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 160]) (ZVar ("\\leq",[]))))] Nothing)),Check (ZMember (ZVar ("bicarbonateConductivity",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 2,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 4]) (ZVar ("\\leq",[]))))] Nothing)),Check (ZMember (ZVar ("dfTemperature",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 33,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 40]) (ZVar ("\\leq",[]))))] Nothing)),Check (ZMember (ZVar ("rinsingTime",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 0,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 59]) (ZVar ("\\leq",[]))))] Nothing)),Check (ZMember (ZVar ("dfFlow",[])) (ZCall (ZVar ("\\cup",[])) (ZTuple [ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 300,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 800]) (ZVar ("\\leq",[]))))] Nothing,ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 50,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 300]) (ZVar ("\\leq",[]))))] Nothing])))])
ZSchemaDef (ZSPlain "UFParameters") (ZSchema [Choose ("ufVol",[]) (ZVar ("NAT",[])),Choose ("therapyTime",[]) (ZVar ("NAT",[])),Choose ("minUFRate",[]) (ZVar ("NAT",[])),Choose ("maxUFRate",[]) (ZVar ("NAT",[])),Check (ZMember (ZVar ("ufVol",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 100,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 20000]) (ZVar ("\\leq",[]))))] Nothing)),Check (ZMember (ZVar ("therapyTime",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 10,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 600]) (ZVar ("\\leq",[]))))] Nothing)),Check (ZMember (ZVar ("minUFRate",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 0,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 500]) (ZVar ("\\leq",[]))))] Nothing)),Check (ZMember (ZVar ("maxUFRate",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 0,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 4000]) (ZVar ("\\leq",[]))))] Nothing))])
ZSchemaDef (ZSPlain "PressureParameters") (ZSchema [Choose ("limitDeltaMinMaxAP",[]) (ZVar ("NAT",[])),Choose ("actualTMPMaxTMP",[]) (ZVar ("NAT",[])),Choose ("limitsTMP",[]) (ZVar ("SWITCH",[])),Choose ("lowHigh",[]) (ZVar ("NAT",[])),Choose ("extendedTMPLimitRange",[]) (ZVar ("SWITCH",[])),Check (ZMember (ZVar ("limitDeltaMinMaxAP",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 10,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 100]) (ZVar ("\\leq",[]))))] Nothing)),Check (ZMember (ZVar ("actualTMPMaxTMP",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 300,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 700]) (ZVar ("\\leq",[]))))] Nothing)),Check (ZMember (ZVar ("lowHigh",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 2,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 99]) (ZVar ("\\leq",[]))))] Nothing))])
ZSchemaDef (ZSPlain "HeparinParameters") (ZSchema [Choose ("heparinStopTime",[]) (ZVar ("TIME",[])),Choose ("heparinBolusVol",[]) (ZVar ("NAT",[])),Choose ("heparinProfileRate",[]) (ZVar ("NAT",[])),Choose ("treatmentWithoutHeparin",[]) (ZVar ("SWITCH",[])),Choose ("syringeType",[]) (ZVar ("NAT",[])),Check (ZMember (ZVar ("heparinStopTime",[])) (ZSetComp [Choose ("h",[]) (ZVar ("NAT",[])),Choose ("m",[]) (ZVar ("NAT",[])),Check (ZAnd (ZAnd (ZMember (ZTuple [ZVar ("h",[]),ZVar ("m",[])]) (ZVar ("TIME",[]))) (ZMember (ZTuple [ZVar ("m",[]),ZInt 60]) (ZVar ("<",[])))) (ZMember (ZTuple [ZVar ("h",[]),ZInt 10]) (ZVar ("\\leq",[]))))] Nothing)),Check (ZMember (ZVar ("heparinBolusVol",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 1,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 100]) (ZVar ("\\leq",[]))))] Nothing)),Check (ZMember (ZVar ("heparinProfileRate",[])) (ZSetComp [Choose ("x",[]) (ZVar ("NAT",[])),Check (ZAnd (ZMember (ZTuple [ZInt 1,ZVar ("x",[])]) (ZVar ("\\leq",[]))) (ZMember (ZTuple [ZVar ("x",[]),ZInt 100]) (ZVar ("\\leq",[]))))] Nothing)),Check (ZMember (ZVar ("syringeType",[])) (ZSetDisplay [ZInt 10,ZInt 20,ZInt 30]))])
CircChanSet "SysClockCs" (CChanSet ["tick","getCurrentTime"])
Process (CProcess "HDMachine" (ProcDef (ProcMain (ZSchemaDef (ZSPlain "HDState") (ZS2 ZSAnd (ZS2 ZSAnd (ZS2 ZSAnd (ZS2 ZSAnd (ZS2 ZSAnd (ZSRef (ZSPlain "HDGenComp") [] []) (ZSRef (ZSPlain "RinsingParameters") [] [])) (ZSRef (ZSPlain "DFParameters") [] [])) (ZSRef (ZSPlain "UFParameters") [] [])) (ZSRef (ZSPlain "PressureParameters") [] [])) (ZSRef (ZSPlain "HeparinParameters") [] []))) [CParAction "SensorReadings" (CircusAction (CSPExtChoice (CSPExtChoice (CSPExtChoice (CSPExtChoice (CSPExtChoice (CSPExtChoice (CSPExtChoice (CSPExtChoice (CSPExtChoice (CSPExtChoice (CSPExtChoice (CSPExtChoice (CSPExtChoice (CSPExtChoice (CSPCommAction (ChanComm "senApTransdPress" [ChanInp "apTransdPress"]) (CActionName "SensorReadings")) (CSPCommAction (ChanComm "senBloodFlowInEBC" [ChanInp "bloodFlowInEBC"]) (CActionName "SensorReadings"))) (CSPCommAction (ChanComm "senBypassVol" [ChanInp "bypassValve"]) (CActionName "SensorReadings"))) (CSPCommAction (ChanComm "senFflowDirect" [ChanInp "fflowDirect"]) (CActionName "SensorReadings"))) (CSPCommAction (ChanComm "senInfVol" [ChanInp "infVol"]) (CActionName "SensorReadings"))) (CSPCommAction (ChanComm "senLastNonZeroBF" [ChanInp "lastNonZeroBF"]) (CActionName "SensorReadings"))) (CSPCommAction (ChanComm "senNetFluidRemoval" [ChanInp "netFluidRemoval"]) (CActionName "SensorReadings"))) (CSPCommAction (ChanComm "senNetFluidRemovalRate" [ChanInp "netFluidRemovalRate"]) (CActionName "SensorReadings"))) (CSPCommAction (ChanComm "senRotDirectBP" [ChanInp "rotDirectionBP"]) (CActionName "SensorReadings"))) (CSPCommAction (ChanComm "senRotDirectUFP" [ChanInp "rotDirectionUFP"]) (CActionName "SensorReadings"))) (CSPCommAction (ChanComm "senVolInEBC" [ChanInp "volumeInEBC"]) (CActionName "SensorReadings"))) (CSPCommAction (ChanComm "senSADSensorFlow" [ChanInp "sadSensorFlow"]) (CActionName "SensorReadings"))) (CSPCommAction (ChanComm "senVpTransdPress" [ChanInp "vpTransdPress"]) (CActionName "SensorReadings"))) (CSPCommAction (ChanComm "senHDMode" [ChanInp "hdMode"]) (CActionName "SensorReadings"))) (CSPCommAction (ChanComm "setMinUFRateTreat" [ChanInp "minUFRateTreat"]) (CActionName "SensorReadings")))),CParAction "StatePhase" (CircusAction (CSPExtChoice (CSPExtChoice (CSPExtChoice (CSPCommAction (ChanComm "preparationPhase" []) (CSPSeq (CActionCommand (CAssign ["hdMachineState"] [ZVar ("prepPhase",[])])) (CActionName "StatePhase"))) (CSPCommAction (ChanComm "connectingToPatient" []) (CSPSeq (CActionCommand (CAssign ["hdMachineState"] [ZVar ("connectThePatient",[])])) (CActionName "StatePhase")))) (CSPCommAction (ChanComm "therapyInitiation" []) (CSPSeq (CActionCommand (CAssign ["hdMachineState"] [ZVar ("initPhase",[])])) (CActionName "StatePhase")))) (CSPCommAction (ChanComm "therapyEnding" []) (CSPSeq (CActionCommand (CAssign ["hdMachineState"] [ZVar ("endPhase",[])])) (CActionName "StatePhase"))))),CParAction "InitState" (CircusAction (CSPSeq (CActionName "HDGenCompInit") (CActionName "SensorReadings"))),CParAction "StopBloodFlow" (CircusAction (CSPCommAction (ChanComm "stopBloodFlow" []) CSPSkip)),CParAction "StopBP" (CircusAction (CSPCommAction (ChanComm "stopBP" []) CSPSkip)),CParAction "StopFlowDialyzer" (CircusAction (CSPCommAction (ChanComm "stopFlowDialyzer" []) CSPSkip)),CParAction "DisconnectDF" (CircusAction (CSPCommAction (ChanComm "disconnectDF" []) CSPSkip)),CParAction "StopCoagulantFlow" (CircusAction (CSPCommAction (ChanComm "stopCoagulantFlow" []) CSPSkip)),CParAction "PreR1" (CircusAction (CActionSchema (ZSchema [Include (ZSRef (ZSDelta "HDState") [] []),Check (ZAnd (ZEqual (ZVar ("hdActivity",[])) (ZSetDisplay [ZVar ("applicationArterialBolus",[])])) (ZMember (ZTuple [ZVar ("infSalineVol",[]),ZInt 400]) (ZVar (">",[]))))]))),CParAction "R1" (CircusAction (CSPInterleave (CSPSeq (CActionName "PreR1") (CActionName "StopBloodFlow")) (CSPExtChoice (CActionName "RaiseAlarm") (CSPSeq (CSPSeq (CActionSchema (ZS1 ZSNot (ZSRef (ZSPlain "PreR1") [] []))) (CSPParAction "Wait" [ZVar ("CheckInterval",[])])) (CActionName "R1"))))),CParAction "NoFlowWatchDog" (CircusAction (CSPExtChoice (CSPGuard (ZMember (ZTuple [ZCall (ZVar ("-",[])) (ZTuple [ZVar ("time",[]),ZVar ("lastNonZeroBF",[])]),ZInt 120000]) (ZVar (">",[]))) (CSPCommAction (ChanComm "tick" []) (CSPSeq (CActionName "StopBP") (CActionName "RaiseAlarm")))) (CSPGuard (ZMember (ZTuple [ZCall (ZVar ("-",[])) (ZTuple [ZVar ("time",[]),ZVar ("lastNonZeroBF",[])]),ZInt 120000]) (ZVar ("\\leq",[]))) (CSPCommAction (ChanComm "tick" []) (CActionName "NoFlowWatchDog"))))),CParAction "BloodFlowSample" (CircusAction (CSPCommAction (ChanComm "senBloodFlowInEBC" [ChanInp "bloodFlowInEBC"]) (CSPSeq (CActionCommand (CIf (CircThenElse (CircGAction (ZNot (ZEqual (ZVar ("bloodFlowInEBC",[])) (ZInt 0))) (CActionCommand (CAssign ["lastNonZeroBF"] [ZVar ("time",[])]))) (CircGAction (ZEqual (ZVar ("bloodFlowInEBC",[])) (ZInt 0)) CSPSkip)))) (CActionName "BloodFlowSample")))),CParAction "R2" (CircusAction (CSPInterleave (CActionName "NoFlowWatchDog") (CActionName "BloodFlowSample"))),CParAction "PreR3" (CircusAction (CActionSchema (ZSchema [Include (ZSRef (ZSDelta "HDState") [] []),Check (ZAnd (ZEqual (ZVar ("hdMachineState",[])) (ZSetDisplay [ZVar ("initPhase",[])])) (ZMember (ZTuple [ZVar ("bloodFlowInEBC",[]),ZCall (ZVar ("\\div",[])) (ZTuple [ZCall (ZVar ("*",[])) (ZTuple [ZVar ("dfFlow",[]),ZInt 70]),ZInt 100])]) (ZVar ("<",[]))))]))),CParAction "R3" (CircusAction (CSPExtChoice (CSPSeq (CActionName "PreR3") (CActionName "RaiseAlarm")) (CSPSeq (CSPSeq (CActionSchema (ZS1 ZSNot (ZSRef (ZSPlain "PreR3") [] []))) (CSPParAction "Wait" [ZVar ("CheckInterval",[])])) (CActionName "R3")))),CParAction "PreR4" (CircusAction (CActionSchema (ZSchema [Include (ZSRef (ZSDelta "HDState") [] []),Check (ZAnd (ZEqual (ZVar ("hdMachineState",[])) (ZCall (ZSetDisplay [ZVar ("initPhase",[])]) (ZVar ("rotDirectionBP",[])))) (ZEqual (ZCall (ZSetDisplay [ZVar ("initPhase",[])]) (ZVar ("rotDirectionBP",[]))) (ZVar ("BACKWARDS",[]))))]))),CParAction "R4" (CircusAction (CSPInterleave (CSPSeq (CActionName "PreR4") (CActionName "StopBP")) (CSPExtChoice (CActionName "RaiseAlarm") (CSPSeq (CSPSeq (CActionSchema (ZS1 ZSNot (ZSRef (ZSPlain "PreR4") [] []))) (CSPParAction "Wait" [ZVar ("CheckInterval",[])])) (CActionName "R4"))))),CParAction "PreR5" (CircusAction (CActionSchema (ZSchema [Include (ZSRef (ZSDelta "HDState") [] []),Check (ZAnd (ZEqual (ZVar ("hdMachineState",[])) (ZSetDisplay [ZVar ("initPhase",[])])) (ZMember (ZTuple [ZVar ("vpTransdPress",[]),ZVar ("upperPressureLimit",[])]) (ZVar (">",[]))))]))),CParAction "R5" (CircusAction (CSPInterleave (CSPSeq (CActionName "PreR5") (CActionName "StopBP")) (CSPExtChoice (CActionName "RaiseAlarm") (CSPSeq (CSPSeq (CActionSchema (ZS1 ZSNot (ZSRef (ZSPlain "PreR5") [] []))) (CSPParAction "Wait" [ZVar ("CheckInterval",[])])) (CActionName "R5"))))),CParAction "ArterialBolusReq" (CircusAction (CActionName "R1")),CParAction "BloodPumpReq" (CircusAction (CSPInterleave (CSPInterleave (CActionName "R2") (CActionName "R3")) (CActionName "R4"))),CParAction "BloodEntryPressureReq" (CircusAction (CSPInterleave (CSPInterleave (CSPInterleave (CSPInterleave (CSPInterleave (CSPInterleave (CSPInterleave (CSPInterleave (CActionName "R5") (CActionName "R6")) (CActionName "R7")) (CActionName "R8")) (CActionName "R9")) (CActionName "R10")) (CActionName "R11")) (CActionName "R12")) (CActionName "R13"))),CParAction "ConnPatientReq" (CircusAction (CSPInterleave (CSPInterleave (CSPInterleave (CActionName "R14") (CActionName "R15")) (CActionName "R16")) (CActionName "R17"))),CParAction "FlowCarbMixChambReq" (CircusAction (CSPInterleave (CActionName "R18") (CActionName "R19"))),CParAction "HeatDegasDFWaterReq" (CircusAction (CSPInterleave (CActionName "R20") (CActionName "R21"))),CParAction "HeparinReq" (CircusAction (CActionName "R22")),CParAction "SafetyAirDetectorReq" (CircusAction (CSPInterleave (CSPInterleave (CSPInterleave (CSPInterleave (CSPInterleave (CActionName "R23") (CActionName "R24")) (CActionName "R25")) (CActionName "R26")) (CActionName "R27")) (CActionName "R2832"))),CParAction "UltrafiltrationReq" (CircusAction (CSPInterleave (CSPInterleave (CSPInterleave (CActionName "R33") (CActionName "R34")) (CActionName "R35")) (CActionName "R36"))),CParAction "SoftwareRequirements" (CircusAction (CSPRecursion "X" (CSPInterleave (CSPInterleave (CSPInterleave (CSPInterleave (CSPInterleave (CSPInterleave (CSPInterleave (CSPInterleave (CActionName "ArterialBolusReq") (CActionName "BloodPumpReq")) (CActionName "BloodEntryPressureReq")) (CActionName "ConnPatientReq")) (CActionName "FlowCarbMixChambReq")) (CActionName "HeatDegasDFWaterReq")) (CActionName "HeparinReq")) (CActionName "SafetyAirDetectorReq")) (CSPSeq (CActionName "UltrafiltrationReq") (CActionName "X"))))),CParAction "AutomatedSelfTest" (CircusAction (CSPCommAction (ChanComm "autSelfTest" []) (CActionCommand (CAssign ["signalLamp"] [ZVar ("GREEN",[])])))),CParAction "ConnectingTheConcentrate" (CircusAction (CSPCommAction (ChanComm "connectingConcentrate" [ChanInp "bicarbonateAcetate"]) CSPSkip)),CParAction "StdAtrialTubing" (CircusAction (CSPCommAction (ChanComm "atrialTubing" []) CSPSkip)),CParAction "StdVentricularTubing" (CircusAction (CSPCommAction (ChanComm "ventricularTubing" []) CSPSkip)),CParAction "InsertRinsingTubingSystem" (CircusAction (CSPInterleave (CActionName "StdAtrialTubing") (CActionName "StdVentricularTubing"))),CParAction "SalineBagLevels" (CircusAction (CSPCommAction (ChanComm "salineBagLevel" [ChanInp "infSalineVol"]) CSPSkip)),CParAction "BloodLines" (CircusAction (CSPCommAction (ChanComm "setBloodLines" []) (CActionCommand (CAssign ["bloodLines"] [ZVar ("TRUE",[])])))),CParAction "RinsingTesting" (CircusAction (CSPCommAction (ChanComm "setRinsingBPSpeed" [ChanInp "rinsingBPRate"]) CSPSkip)),CParAction "InsertingRinsingTestingTubSystem" (CircusAction (CSPSeq (CSPSeq (CSPSeq (CActionName "InsertRinsingTubingSystem") (CActionName "SalineBagLevels")) (CActionName "BloodLines")) (CActionName "RinsingTesting"))),CParAction "PrepHeparinPump" (CircusAction (CSPCommAction (ChanComm "insertHeparinSyringe" []) (CSPCommAction (ChanComm "heparinLineIsVented" []) CSPSkip))),CParAction "SetTreatmentParameters" (CircusAction (CSPSeq (CSPSeq (CSPSeq (CActionName "SetDFParameters") (CActionName "SetUFParameters")) (CActionName "SetPressureParameters")) (CActionName "SetHeparinParameters"))),CParAction "RinsingDialyzer" (CircusAction (CSPCommAction (ChanComm "connectDialyzer" []) (CSPCommAction (ChanComm "fillArterialDrip" []) (CSPCommAction (ChanComm "stopBP" []) CSPSkip)))),CParAction "TherapyPreparation" (CircusAction (CSPCommAction (ChanComm "preparationPhase" []) (CSPSeq (CSPSeq (CSPSeq (CSPSeq (CSPSeq (CSPSeq (CActionName "AutomatedSelfTest") (CActionName "ConnectingTheConcentrate")) (CActionName "SetRinsingParameters")) (CActionName "InsertingRinsingTestingTubSystem")) (CActionName "PrepHeparinPump")) (CActionName "SetTreatParameters")) (CActionName "RinsingDialyzer")))),CParAction "EnableUI" (CircusAction (CActionCommand (CAssign ["signalLamp"] [ZVar ("YELLOW",[])]))),CParAction "ConnectPatientArterially" (CircusAction (CSPCommAction (ChanComm "connPatientArterially" []) CSPSkip)),CParAction "ConnectPatientVenously" (CircusAction (CSPCommAction (ChanComm "connPatientVenously" []) CSPSkip)),CParAction "SetStopBloodFlow" (CircusAction (CSPCommAction (ChanComm "setBloodFlow" [ChanInp "bloodFlowInEBC"]) CSPSkip)),CParAction "ConnectPatientStartTherapy" (CircusAction (CSPSeq (CSPSeq (CSPSeq (CSPSeq (CSPSeq (CActionCommand (CAssign ["hdMachineState"] [ZVar ("connectThePatient",[])])) (CActionName "EnableUI")) (CActionName "ConnectPatientArterially")) (CActionName "SetStopBloodFlow")) (CActionName "ConnectPatientVenously")) (CActionCommand (CAssign ["signalLamp","hdMode"] [ZVar ("GREEN",[]),ZVar ("RUN",[])])))),CParAction "MonitorBPLimits" (CircusAction CSPSkip),CParAction "TreatMinUFRate" (CircusAction (CSPCommAction (ChanComm "setMinUFRateTreat" [ChanInp "ON"]) CSPSkip)),CParAction "HeparinBolus" (CircusAction CSPSkip),CParAction "ArterialBolus" (CircusAction (CSPCommAction (ChanComm "setArtBolusVol" [ChanInp "artBolusVol"]) CSPSkip)),CParAction "InterruptDialysis" (CircusAction (CSPCommAction (ChanComm "senHDMode" [ChanOutExp (ZVar ("BYPASS",[]))]) (CActionCommand (CAssign ["signalLamp"] [ZVar ("YELLOW",[])])))),CParAction "CompletTreatment" (CircusAction (CSPCommAction (ChanComm "endTreatment" []) (CActionCommand (CAssign ["signalLamp"] [ZVar ("YELLOW",[])])))),CParAction "DuringTherapy" (CircusAction (CSPInterleave (CSPInterleave (CSPInterleave (CSPInterleave (CActionName "MonitorBPLimits") (CActionName "TreatMinUFRate")) (CActionName "HeparinBolus")) (CActionName "ArterialBolus")) (CSPSeq (CActionName "InterruptDialysis") (CActionName "CompletTreatment")))),CParAction "TherapyInitiation" (CircusAction (CSPCommAction (ChanComm "therapyInitiation" []) (CSPSeq (CActionName "ConnectPatientStartTherapy") (CActionName "DuringTherapy")))),CParAction "Reinfusion" (CircusAction CSPSkip),CParAction "EmptyingDialyzer" (CircusAction CSPSkip),CParAction "EmptyingCartridge" (CircusAction CSPSkip),CParAction "OverviewTherapy" (CircusAction CSPSkip),CParAction "TherapyEnding" (CircusAction (CSPCommAction (ChanComm "therapyEnding" []) (CSPSeq (CSPSeq (CSPSeq (CActionName "Reinfusion") (CActionName "EmptyingDialyzer")) (CActionName "EmptyingCartridge")) (CActionName "OverviewTherapy")))),CParAction "MainTherapy" (CircusAction (CSPSeq (CSPSeq (CActionName "TherapyPreparation") (CActionName "TherapyInitiation")) (CActionName "TherapyEnding"))),CParAction "HDMachine" (CircusAction (CSPParal (CSExpr "HDMachineChanSet") (CSPParal (CSExpr "TherapyPhaseChanSet") (CSPParal (CSExpr "HDMachineChanSet") (CSPSeq (CActionName "HDGenCompInit") (CActionName "MainTherapy")) (CActionName "SoftwareRequirements")) (CActionName "StatePhase")) (CActionName "SensorReadings")))] (CSPParal (CSExpr "SysClockCs") (CActionName "HDMachine") (CActionName "SysClock")))))
